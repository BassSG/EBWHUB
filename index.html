<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b111b">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EBassWave AI Hub">
  
  <!-- PWA Meta Tags -->
  <meta name="application-name" content="EBassWave AI Hub">
  <meta name="msapplication-TileColor" content="#0b111b">
  <meta name="msapplication-config" content="browserconfig.xml">
  
  <title>EBassWave AI Hub</title>
  <meta name="description" content="AI isn't everything. But it's everything.">
  <meta name="color-scheme" content="dark">
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="#" id="manifest-placeholder">
  
  <style>
    :root{
      --bg-0:#070b12;
      --bg-1:#0b111b;
      --bg-2:#0f1625;
      --ink:#e8f1ff;
      --ink-soft:#d1dce8;
      --muted:#93a3b8;
      --muted-light:#a8b5c7;
      --cyan:#53d7ff;
      --green:#39ffb6;
      --violet:#a88bff;
      --blue:#4c79ff;
      --orange:#ff8a4c;
      --pink:#ff6b9d;
      --card:#0f1625aa;
      --card-solid:#0f1625;
      --border:#1f2a40;
      --border-light:#2a3548;
      --shadow: 0 10px 20px rgba(0,0,0,.35), 0 2px 6px rgba(0,0,0,.25);
      --shadow-lg: 0 20px 40px rgba(0,0,0,.4), 0 8px 16px rgba(0,0,0,.3);
      --glow-soft: 0 0 20px rgba(83,215,255,.15);
    }
    
    *{box-sizing:border-box}
    html,body{height:100%}
    
    body{
      margin:0; 
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink); 
      background: 
        radial-gradient(1200px 600px at 15% -5%, rgba(83,215,255,.07) 0%, transparent 50%),
        radial-gradient(1000px 500px at 85% 10%, rgba(168,139,255,.05) 0%, transparent 50%),
        radial-gradient(700px 350px at 50% 80%, rgba(57,255,182,.035) 0%, transparent 50%),
        linear-gradient(135deg, var(--bg-0) 0%, var(--bg-1) 50%, var(--bg-2) 100%);
      min-height: 100vh;
      letter-spacing:.3px;
      overflow-x: hidden;
    }

    /* Install Button Styles */
    .install-container {
      position: fixed;
      bottom: 14px;
      right: 14px;
      z-index: 1000;
      opacity: 0;
      transform: translateY(60px);
      transition: all 0.25s ease;
    }

    .install-container.show {
      opacity: 1;
      transform: translateY(0);
    }

    .install-btn {
      background: linear-gradient(135deg, var(--cyan), var(--green));
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      color: var(--bg-0);
      font-weight: 700;
      font-size: 0.85rem;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(83,215,255,.28);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.25s ease;
      font-family: inherit;
    }

    .install-btn svg { width: 18px; height: 18px; fill: currentColor; }

    /* Status Bar for PWA */
    .status-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: env(safe-area-inset-top, 0);
      background: var(--bg-0);
      z-index: 1000;
    }

    /* Background mesh */
    .mesh{ position: fixed; inset:0; pointer-events:none; z-index: -1; }
    .mesh::before,.mesh::after{
      content: ""; position: absolute; inset:0;
      filter: blur(48px); opacity: .18;
      background:
        radial-gradient(circle at 25% 30%, rgba(83,215,255,.38), transparent 50%),
        radial-gradient(circle at 75% 70%, rgba(168,139,255,.3), transparent 50%),
        radial-gradient(circle at 50% 10%, rgba(57,255,182,.26), transparent 50%);
      animation: float 22s ease-in-out infinite alternate;
    }
    .mesh::after{ 
      animation: float 30s ease-in-out infinite alternate-reverse; 
      mix-blend-mode: screen; opacity: .12;
      background:
        radial-gradient(circle at 80% 20%, rgba(255,138,76,.22), transparent 60%),
        radial-gradient(circle at 20% 80%, rgba(255,107,157,.18), transparent 60%);
    }
    @keyframes float{
      0%{transform:translate3d(-2%, -1%, 0) scale(1.01)}
      50%{transform:translate3d(1%, 1%, 0) scale(1.05)}
      100%{transform:translate3d(2%, 1%, 0) scale(1.02)}
    }

    .wrap{
      max-width:1120px; 
      margin:0 auto; 
      padding: clamp(12px, 2.5vw, 24px);
      position: relative;
      padding-top: calc(clamp(8px, 2vw, 18px) + env(safe-area-inset-top, 0));
    }    
    
    header{
      text-align:center; 
      padding: clamp(28px, 6vw, 56px) 0 clamp(18px, 3vw, 28px);
      position:relative;
    }

    .brand{ 
      display:inline-flex; align-items:center; justify-content:center; 
      width:72px; height:72px; margin:0 auto 12px; 
      border-radius:18px; position:relative; overflow:hidden;
      background: linear-gradient(135deg, rgba(15,22,37,.8), rgba(11,17,27,.9));
      border: 1px solid var(--border-light);
      box-shadow: var(--glow-soft), inset 0 1px 0 rgba(255,255,255,.06);
    }
    .brand::before{
      content: ""; position: absolute; inset: -2px; border-radius: inherit;
      background: linear-gradient(135deg, var(--cyan), var(--green), var(--violet));
      z-index: -1; opacity: .5; filter: blur(8px);
    }
    .brand img{ width:100%; height:100%; object-fit: cover; border-radius: inherit; }

    .tag{
      display:inline-flex; align-items:center; gap:.5rem;
      padding:.32rem .8rem; border:1px solid var(--border-light); border-radius:999px;
      font-size:.82rem; font-weight: 500; color:var(--muted-light);
      background: linear-gradient(135deg, rgba(15,22,37,.9), rgba(10,18,32,.95)); 
      backdrop-filter: blur(10px);
      box-shadow: 0 3px 10px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.08);
      margin-bottom: .6rem;
    }
    .tag i{ width:.6rem; height:.6rem; border-radius:50%; display:inline-block;
      background: radial-gradient(circle at 30% 30%, var(--cyan), var(--green) 70%); }

    h1{
      margin:.5rem 0 0; font-weight:900; 
      font-size:clamp(1.9rem, 5.8vw, 3.6rem); line-height:1.06; letter-spacing:.6px;
      background: linear-gradient(135deg, var(--cyan) 0%, var(--green) 30%, var(--violet) 70%, var(--pink) 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 0 30px rgba(83,215,255,.25);
    }

    .sub{
      margin: .7rem auto 0; max-width: 560px; 
      color:var(--ink-soft); font-size: clamp(.98rem, 1.6vw, 1.08rem);
      line-height: 1.55; opacity: .92;
    }

    .grid{
      margin-top: clamp(22px, 4vw, 36px);
      display:grid; gap: clamp(12px, 1.8vw, 18px);
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }
    
    a.card{
      display: flex; padding: clamp(14px, 2vw, 18px);
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(15,22,37,.88), rgba(11,17,27,.94));
      border: 1px solid var(--border);
      text-decoration: none; color: inherit; position: relative;
      transition: all .25s cubic-bezier(.4,0,.2,1);
      backdrop-filter: blur(10px);
      box-shadow: 0 3px 10px rgba(0,0,0,.14);
      min-height: 96px;
      will-change: transform;
      transform: translateZ(0);
      animation: fadeInUp 0.48s ease-out forwards;
    }
    .card:nth-child(1) { animation-delay: 0.08s; }
    .card:nth-child(2) { animation-delay: 0.12s; }
    .card:nth-child(3) { animation-delay: 0.16s; }
    .card:nth-child(4) { animation-delay: 0.20s; }
    .card:nth-child(5) { animation-delay: 0.24s; }
    .card:nth-child(6) { animation-delay: 0.28s; }
    .card:nth-child(7) { animation-delay: 0.32s; }
    .card:nth-child(8) { animation-delay: 0.36s; }

    a.card::before{
      content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none; z-index:-1;
      background: radial-gradient(240px 240px at var(--mx,50%) var(--my,50%), 
        color-mix(in oklab, var(--glow) 36%, transparent), transparent 70%);
      transition: opacity .25s ease; opacity:0;
    }
    .card:hover{ 
      transform: translateY(-6px) scale(1.01); 
      border-color: color-mix(in oklab, var(--glow) 45%, var(--border));
      box-shadow: 0 0 0 1px color-mix(in oklab, var(--glow) 26%, transparent), 
                  0 16px 38px color-mix(in oklab, var(--glow) 16%, rgba(0,0,0,.28)), 
                  var(--shadow-lg);
    }
    .card:hover::before{ opacity:.7 }

    .ico{
      width:46px; height:46px; border-radius:14px; display:grid; place-items:center;
      background: linear-gradient(135deg, 
        color-mix(in oklab, var(--glow) 25%, rgba(15,22,37,.9)), 
        color-mix(in oklab, var(--glow) 15%, rgba(10,18,32,.95)));
      box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--glow) 38%, rgba(255,255,255,.1)), 
                  0 0 18px color-mix(in oklab, var(--glow) 22%, transparent),
                  0 3px 7px rgba(0,0,0,.2);
      position: relative;
    }
    .ico svg{ width:22px; height:22px; stroke: var(--ink); opacity:.95; }

    .title{ font-weight:700; font-size: 1.02rem; letter-spacing:.25px; margin-top:6px; color: var(--ink); }
    .desc{ color:var(--muted-light); font-size:.9rem; margin-top: 3px; line-height: 1.35; }

    .arrow{
      margin-left:auto; width:28px; height:28px; border-radius:10px; display:grid; place-items:center;
      border:1px solid var(--border-light);
      background: linear-gradient(135deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      transition: all .25s cubic-bezier(.4,0,.2,1);
      backdrop-filter: blur(6px);
    }
    .card:hover .arrow{
      transform: translateX(5px) scale(1.06);
      border-color: color-mix(in oklab, var(--glow) 55%, var(--border));
      box-shadow: 0 0 12px color-mix(in oklab, var(--glow) 30%, transparent);
    }
    .arrow svg{ width: 14px; height: 14px; stroke: var(--ink-soft); stroke-width: 2; }
    
    .row{ display:flex; align-items:center; gap:14px; width: 100%; }
    .spacer{ flex:1 }

    a.card:focus-visible{ outline: 2px solid var(--blue); outline-offset: 3px; transform: translateY(-4px) scale(1.005); }

    footer{ 
      color:var(--muted); text-align:center; margin: 32px 0 16px; 
      font-size:.88rem; font-weight: 400; opacity: .85;
      padding-bottom: env(safe-area-inset-bottom, 16px);
    }

    @media (prefers-reduced-motion: reduce){
      .mesh::before,.mesh::after{ animation:none }
      .card, .arrow, .install-btn{ transition: none; animation: none; }
    }

    @media (max-width:768px){
      .mesh::before,.mesh::after{ filter: blur(36px); opacity: .14; }
      .grid{ grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 12px; }
      .brand{ width:66px; height:66px; }
      .install-container { bottom: 12px; right: 12px; }
    }
    
    @media (max-width:480px){
      h1{ font-size: clamp(1.7rem, 7.4vw, 2.4rem) }
      .grid{ grid-template-columns: 1fr; gap: 12px }
      a.card{ min-height:92px; padding:14px; border-radius:14px }
      .ico{ width:42px; height:42px; border-radius:12px }
      .ico svg{ width:20px; height:20px; }
      .title{ font-size:.98rem }
      .desc{ font-size:.88rem }
      .arrow{ width:26px; height:26px; }
    }

    @media (hover: none){
      .card:hover{ transform: translateY(-3px) scale(1.005); box-shadow: var(--shadow-lg); }
      .card:hover::before{ opacity:.45 }
      .card:hover .arrow{ transform: translateX(3px); }
    }
    
    @supports (padding: max(0px)){
      body{ 
        padding-bottom:max(16px, env(safe-area-inset-bottom)); 
        padding-top:max(0px, env(safe-area-inset-top)); 
      }
    }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }

    /* PWA Standalone mode styles */
    @media (display-mode: standalone) { .status-bar { display: block; } .install-container { display: none; } }
    @media (display-mode: browser) { .status-bar { display: none; } }
  </style>
</head>
<body>
  <!-- Status bar for PWA -->
  <div class="status-bar"></div>
  
  <!-- Install button -->
  <div class="install-container" id="installContainer">
    <button class="install-btn" id="installBtn">
      <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
      ติดตั้งแอป
    </button>
  </div>

  <div class="mesh" aria-hidden="true"></div>
  <div class="wrap">
    <header>
      <div class="brand" aria-hidden="true">
        <img id="brandImg" alt="EBassWave Logo">
      </div>
      <span class="tag" aria-label="AI style tag"><i></i> Modern • AI • Tech</span>
      <h1 aria-label="EBassWave AI Hub">EBassWave AI Hub</h1>
      <p class="sub">ศูนย์กลางงานของคุณในที่เดียว—ดีไซน์เรียบ สะอาด โมเดิร์น โทนนีออนล้ำสมัย</p>
    </header>

    <main class="grid" aria-label="Quick Links">
      <a class="card" href="https://basssg.github.io/TAPro-DEV/" style="--glow: var(--cyan)" aria-label="TAPro">
        <div class="row">
          <div class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M3 3v18h18"/>
              <path d="M6 16l3-3 3 2 5-7"/>
              <circle cx="17" cy="7" r="1.2"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">TAPro</div>
            <div class="desc">แพลตฟอร์มวิเคราะห์เทรดอัตโนมัติ</div>
          </div>
          <div class="arrow" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>

      <a class="card" href="https://basssg.github.io/TAProAlert-Dashboard/" style="--glow: var(--violet)" aria-label="Dashboard">
        <div class="row">
          <div class="ico">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M4 7h16M4 12h16M4 17h16"/>
              <circle cx="9" cy="7" r="2"/><circle cx="15" cy="12" r="2"/><circle cx="7" cy="17" r="2"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">Dashboard</div>
            <div class="desc">สรุปตัวชี้วัดและสถานะระบบ</div>
          </div>
          <div class="arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>

      <a class="card" href="https://basssg.github.io/SnDForex/" style="--glow: var(--green)" aria-label="SnDFX">
        <div class="row">
          <div class="ico">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M4 20V10"/><path d="M10 20V6"/><path d="M16 20V13"/>
              <path d="M3 20h18"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">SnDFX</div>
            <div class="desc">โซน Supply/Demand</div>
          </div>
          <div class="arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>

      <a class="card" href="https://basssg.github.io/GoogleSheet/" style="--glow: var(--orange)" aria-label="GoogleSheet">
        <div class="row">
          <div class="ico">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 9h18M3 15h18M9 3v18M15 3v18"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">GoogleSheet</div>
            <div class="desc">สเปรดชีตและสคริปต์เสริม</div>
          </div>
          <div class="arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>

      <a class="card" href="https://basssg.github.io/GoogleAppScript/" style="--glow: var(--pink)" aria-label="Google App Script">
        <div class="row">
          <div class="ico">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M9 7L5 12l4 5"/><path d="M15 7l4 5-4 5"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">Google App Script</div>
            <div class="desc">สคริปต์อัตโนมัติบน Google</div>
          </div>
          <div class="arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>

      <a class="card" href="https://basssg.github.io/Investment/" style="--glow: var(--blue)" aria-label="Investment">
        <div class="row">
          <div class="ico">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M3 3v18h18"/>
              <path d="M6 16l4-4 3 2 5-7"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">Investment</div>
            <div class="desc">ข้อมูลการลงทุนและพอร์ต</div>
          </div>
          <div class="arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>

      <a class="card" href="https://basssg.github.io/TripPlanner/" style="--glow: var(--green)" aria-label="TripPlanner">
        <div class="row">
          <div class="ico">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M12 21s7-5.2 7-11a7 7 0 1 0-14 0c0 5.8 7 11 7 11z"/>
              <circle cx="12" cy="10" r="2.5"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">TripPlanner</div>
            <div class="desc">วางแผนการเดินทางอัจฉริยะ</div>
          </div>
          <div class="arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>

      <a class="card" href="https://basssg.github.io/Pickup/" style="--glow: var(--cyan)" aria-label="PickUp">
        <div class="row">
          <div class="ico">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.8">
              <path d="M3 15h2l2-3h6l2 3h4"/>
              <circle cx="7" cy="18" r="2"/>
              <circle cx="17" cy="18" r="2"/>
            </svg>
          </div>
          <div class="spacer">
            <div class="title">PickUp</div>
            <div class="desc">ระบบนัดรับ/ขนส่งเรียลไทม์</div>
          </div>
          <div class="arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M8 5l7 7-7 7"/></svg>
          </div>
        </div>
      </a>
    </main>

    <footer>
      © <span id="y"></span> EBassWave AI Hub • Built for speed, clarity, and control
    </footer>
  </div>

  <script>
    // ===================== ICON SOURCE (EXTERNAL) =====================
    const ICON_URL = "https://s15-kling.klingai.com/kimg/EMXN1y8qTQoGdXBsb2FkEg55bGFiLXN0dW50LXNncBoza2xpbmcvZG93bmxvYWQvTWpnNE1qUXpPVFF3TXpBd01UUTJNVGt3TkRZMk5qTTRNUT09.origin?x-kcdn-pid=112372";
    document.getElementById('brandImg').src = ICON_URL;

    // Enhanced hover glow effect
    const canHover = matchMedia('(hover: hover)').matches;
    if (canHover){
      for (const card of document.querySelectorAll('.card')){
        card.addEventListener('pointermove', (e)=>{
          const r = card.getBoundingClientRect();
          card.style.setProperty('--mx', (e.clientX - r.left) + 'px');
          card.style.setProperty('--my', (e.clientY - r.top) + 'px');
        }, {passive:true});
        card.addEventListener('pointerleave', ()=>{
          card.style.setProperty('--mx', '50%');
          card.style.setProperty('--my', '50%');
        }, {passive:true});
      }
    }

    // Year
    document.getElementById('y').textContent = new Date().getFullYear();

    // ===================== LOAD & GENERATE ICON SIZES =====================
    function loadImage(url){
      return new Promise((resolve, reject)=>{
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = url;
      });
    }

    function drawCover(ctx, img, size){
      const iw = img.naturalWidth || img.width;
      const ih = img.naturalHeight || img.height;
      const minSide = Math.min(iw, ih);
      const sx = (iw - minSide) / 2;
      const sy = (ih - minSide) / 2;
      ctx.clearRect(0,0,size,size);
      ctx.drawImage(img, sx, sy, minSide, minSide, 0, 0, size, size);
    }

    async function generateIconDataURLs(){
      const sizes = [16,32,48,72,96,128,144,152,180,192,384,512];
      try{
        const img = await loadImage(ICON_URL);
        const out = {};
        for (const s of sizes){
          const c = document.createElement('canvas');
          c.width = c.height = s;
          const x = c.getContext('2d');
          drawCover(x, img, s);
          out[s] = c.toDataURL('image/png');
        }
        return out;
      }catch(e){
        return null; // Fallback to using original URL
      }
    }

    (async function setupIconsAndManifest(){
      const iconsMap = await generateIconDataURLs();
      const use = (sz)=> iconsMap ? iconsMap[sz] : ICON_URL;

      const addLink = (rel, sizes, href, type) => {
        const el = document.createElement('link');
        el.rel = rel;
        if (sizes) el.sizes = sizes;
        if (type) el.type = type;
        el.href = href;
        document.head.appendChild(el);
      };
      addLink('icon', '16x16', use(16), 'image/png');
      addLink('icon', '32x32', use(32), 'image/png');
      addLink('apple-touch-icon', '180x180', use(180), null);

      const manifest = {
        name: 'EBassWave AI Hub',
        short_name: 'EBassWave',
        description: 'ศูนย์กลางงานของคุณในที่เดียว—ดีไซน์เรียบ สะอาด โมเดิร์น โทนนีออนล้ำสมัย',
        start_url: '/',
        scope: '/',
        display: 'standalone',
        orientation: 'portrait-primary',
        background_color: '#0b111b',
        theme_color: '#0b111b',
        lang: 'th',
        dir: 'ltr',
        categories: ['productivity', 'utilities', 'business'],
        screenshots: [{ src: use(512), sizes: '512x512', type: 'image/png', form_factor: 'narrow' }],
        icons: [
          { src: use(48),  sizes: '48x48',  type: 'image/png', purpose: 'any' },
          { src: use(72),  sizes: '72x72',  type: 'image/png', purpose: 'any' },
          { src: use(96),  sizes: '96x96',  type: 'image/png', purpose: 'any' },
          { src: use(128), sizes: '128x128',type: 'image/png', purpose: 'any' },
          { src: use(144), sizes: '144x144',type: 'image/png', purpose: 'any' },
          { src: use(152), sizes: '152x152',type: 'image/png', purpose: 'any' },
          { src: use(180), sizes: '180x180',type: 'image/png', purpose: 'any' },
          { src: use(192), sizes: '192x192',type: 'image/png', purpose: 'any' },
          { src: use(384), sizes: '384x384',type: 'image/png', purpose: 'any' },
          { src: use(512), sizes: '512x512',type: 'image/png', purpose: 'any' }
        ]
      };
      const mblob = new Blob([JSON.stringify(manifest)], {type:'application/manifest+json'});
      const mlink = document.createElement('link'); 
      mlink.rel='manifest'; 
      mlink.href = URL.createObjectURL(mblob); 
      document.head.appendChild(mlink);
    })();

    // ===================== SERVICE WORKER =====================
    if ('serviceWorker' in navigator){
      const swCode = `
        const CACHE_NAME = 'ebasswave-v1';
        const urlsToCache = ['/', '/index.html', '${ICON_URL}'];

        self.addEventListener('install', event => {
          event.waitUntil(
            caches.open(CACHE_NAME)
              .then(cache => cache.addAll(urlsToCache))
              .then(() => self.skipWaiting())
          );
        });

        self.addEventListener('activate', event => {
          event.waitUntil(
            caches.keys().then(cacheNames => Promise.all(
              cacheNames.map(n => n !== CACHE_NAME ? caches.delete(n) : null)
            )).then(() => self.clients.claim())
          );
        });

        self.addEventListener('fetch', event => {
          event.respondWith(
            caches.match(event.request).then(res => res || fetch(event.request))
          );
        });
      `;
      const swBlob = new Blob([swCode], {type:'text/javascript'});
      navigator.serviceWorker.register(URL.createObjectURL(swBlob))
        .then(() => console.log('SW registered successfully'))
        .catch(() => console.log('SW registration failed'));
    }

    // ===================== INSTALL PROMPT =====================
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    const installContainer = document.getElementById('installContainer');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installContainer.classList.add('show');
    });

    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('Install prompt outcome:', outcome);
        deferredPrompt = null;
        installContainer.classList.remove('show');
      }
    });

    window.addEventListener('appinstalled', () => {
      console.log('PWA was installed');
      installContainer.classList.remove('show');
      deferredPrompt = null;
    });

    if (window.matchMedia('(display-mode: standalone)').matches) {
      installContainer.style.display = 'none';
    }

    // Smooth scroll
    document.documentElement.style.scrollBehavior = 'smooth';

    // Performance monitoring
    if ('performance' in window) {
      window.addEventListener('load', () => {
        const perfData = performance.getEntriesByType('navigation')[0];
        if (perfData) console.log('Page load time:', perfData.loadEventEnd - perfData.loadEventStart, 'ms');
      });
    }
  </script>
</body>
</html>
